<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>

  <body></body>
  <script>
    //#region // NOTE: Part 1 allKeysAndSymbols
    // ÐÐ°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑŽ, ÐºÐ¾Ñ‚Ð¾Ñ€Ð°Ñ Ð¿Ñ€Ð¸Ð½Ð¸Ð¼Ð°ÐµÑ‚ Ð¾Ð±ÑŠÐµÐºÑ‚ Ð¸ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ Ð²ÑÐµ ÑÐ²Ð¾Ð¹ÑÑ‚Ð²Ð° Ð¸ ÑÐ¸Ð¼Ð²Ð¾Ð»Ñ‹ ÐºÐ°Ðº Ð² ÑÐ°Ð¼Ð¾Ð¼ Ð¾Ð±ÑŠÐµÐºÑ‚Ðµ,
    // Ñ‚Ð°Ðº Ð¸ Ð²Ð¾ Ð²ÑÐµÐ¹ ÐµÐ³Ð¾ Ñ†ÐµÐ¿Ð¾Ñ‡ÐºÐµ Ð¿Ñ€Ð¾Ñ‚Ð¾Ñ‚Ð¸Ð¿Ð¾Ð².

    const proto = { value: 42 };
    const object = Object.create(proto);

    function allKeysAndSymbols(object) {
      // let result = false;
      // for (let prop in object) {
      //   console.log(prop);
      //   result = [(prop, Object.getPrototypeOf(prop))];
      // }
      // console.log(result);
      // console.log(Object.getPrototypeOf(object), 'prototype');
      // console.log(object);
      // console.log(object.__proto__);
    }

    allKeysAndSymbols(object); // ["constructor", "__defineGetter__", "__defineSetter__", "hasOwnProperty", ... ]
    //#endregion

    //#region // NOTE: Part 2 in, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð¸Ð³Ð½Ð¾Ñ€Ð¸Ñ€ÑƒÐµÑ‚ ÑÐ²Ð¾Ð¹ÑÑ‚Ð²Ð° Ð¿Ñ€Ð¾Ñ‚Ð¾Ñ‚Ð¸Ð¿Ð°
    // ÐÐ°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ Ð¿Ñ€Ð¾ÐºÑÐ¸-Ð¾Ð±ÑŠÐµÐºÑ‚, Ð´Ð»Ñ ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ð³Ð¾ Ð¾Ð¿ÐµÑ€Ð°Ñ‚Ð¾Ñ€ in Ð²ÐµÑ€Ð½ÐµÑ‚ Ð¸ÑÑ‚Ð¸Ð½Ñƒ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð² Ñ‚Ð¾Ð¼ ÑÐ»ÑƒÑ‡Ð°ÐµÑ‚,
    // ÐºÐ¾Ð³Ð´Ð° ÑÐ²Ð¾Ð¹ÑÑ‚Ð²Ð¾ Ð½Ð°Ñ…Ð¾Ð´Ð¸Ñ‚ÑÑ Ð² ÑÐ°Ð¼Ð¾Ð¼ Ð¾Ð±ÑŠÐµÐºÑ‚Ðµ, Ð½Ð¾ Ð½Ðµ Ð² ÐµÐ³Ð¾ Ð¿Ñ€Ð¾Ñ‚Ð¾Ñ‚Ð¸Ð¿Ðµ.
    const proto2 = { value: 42 };
    const object2 = Object.create(proto2);

    Object.defineProperty(object2, 'year', {
      value: 2020,
      writable: true,
      configurable: true,
      enumerable: false,
    });

    const symbol = Symbol('bazzinga');
    object2[symbol] = 42;

    // Ð±ÐµÐ· proxy
    console.log('value' in object2); // true
    console.log('year' in object2); // true
    console.log(symbol in object2); // true

    const proxy = new Proxy(object2, {
      has(target, key) {
        if (target.hasOwnProperty(key)) {
          return true;
        }
        return false;
      },
    }); // Ñ€ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ
    // Ñ proxy
    console.log('value' in proxy); // false
    console.log('year' in proxy); // true
    console.log(symbol in proxy); // true
    //#endregion

    //#region // NOTE: Part 3 asyncExecutor
    // ÐÐ°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑŽ, ÐºÐ¾Ñ‚Ð¾Ñ€Ð°Ñ Ð¿Ð¾Ð·Ð²Ð¾Ð»Ð¸Ñ‚ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð²Ð½ÑƒÑ‚Ñ€Ð¸ Ð³ÐµÐ½ÐµÑ€Ð°Ñ‚Ð¾Ñ€Ð° Ð°ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ñ‹Ðµ Ð²Ñ‹Ð·Ð¾Ð²Ñ‹.
    // Ð ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð½Ð° Promise, async/await Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð·Ð°Ð¿Ñ€ÐµÑ‰ÐµÐ½Ð¾.

    function asyncExecutor(generator) {
      // Ñ€ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ
      const it = generator();

      (function iterate(value) {
        const result = it.next(value);

        if (!result.done) {
          //NOTE: Ð¼Ð¾Ð¶Ð½Ð¾ ÐµÑ‰Ðµ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÑ‚ÑŒ Ñ‡ÐµÑ€ÐµÐ· ('then' in result.value)
          if (Promise.resolve(result.value) === result.value) {
            result.value.then(iterate);
          } else {
            //NOTE: Ð½Ð° ÑÐ»ÑƒÑ‡Ð°Ð¹, ÐµÑÐ»Ð¸ Ð²Ð´Ñ€ÑƒÐ³ Ð±ÑƒÐ´ÐµÑ‚ Ñ‡Ñ‚Ð¾-Ñ‚Ð¾ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ð¾Ðµ
            //NOTE: Ð´Ð¾Ð±Ð°Ð²Ð¸Ð» Ð² Ñ‚ÐµÑÑ‚Ñ‹ Data2-4
            setTimeout(function () {
              iterate(result.value);
            }, 0);
          }
        }
      })();
    }

    // Ñ‚ÐµÑÑ‚Ñ‹
    const ID = 42;
    const delayMS = 1000;

    function getId() {
      return new Promise((resolve) => {
        setTimeout(() => {
          resolve(ID);
        }, delayMS);
      });
    }

    function getDataById(id) {
      return new Promise((resolve, reject) => {
        setTimeout(() => {
          id === ID ? resolve('ðŸŽ') : reject('ðŸ’¥');
        }, delayMS);
      });
    }

    asyncExecutor(function* () {
      console.time('Time');

      const id = yield getId();
      const data = yield getDataById(id);
      const data2 = yield 'Ð­Ñ‚Ð° ÑÑ‚Ñ€Ð¾ÐºÐ° Ð½Ðµ Ð¿Ð¾ÑÐ²Ð¸Ñ‚ÑÑ, ÐµÑÐ»Ð¸ Ð½Ðµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ setTimeout()';
      const data3 = yield 'Ð˜ ÑÑ‚Ð° ÑÑ‚Ñ€Ð¾ÐºÐ° Ð½Ðµ Ð¿Ð¾ÑÐ²Ð¸Ñ‚ÑÑ';
      const data4 = yield 'ÐÐ¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ Ð¿Ð¾ÑÐ²Ð¸Ñ‚ÑÑ :(';

      console.log('Data', data);
      console.log('Data2', data2);
      console.log('Data3', data3);
      console.log('Data4', data4);

      console.timeEnd('Time');
    });
    //#endregion

    //#region // NOTE: Part 4 Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ðµ Ð·Ð°Ð´Ð°Ð½Ð¸Ðµ: ÑÐ¾Ð±ÑÑ‚Ð²ÐµÐ½Ð½Ð°Ñ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Set
    // ÐÐ°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ ÑÐ²Ð¾Ð¹ ÐºÐ»Ð°ÑÑ, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð±ÑƒÐ´ÐµÑ‚ Ð¾Ñ‡ÐµÐ½ÑŒ Ð¿Ð¾Ñ…Ð¾Ð´ Ð½Ð° ES6 Ð¼Ð½Ð¾Ð¶ÐµÑÑ‚Ð²Ð°.

    class MySet {
      constructor(set) {
        this.set = set.filter((el, i, arr) => {
          return arr.includes(el) && arr.indexOf(el) === i;
        });
      }

      [Symbol.iterator]() {
        return this.set.values();
      }

      get [Symbol.toStringTag]() {
        return 'MySet';
      }

      keys() {
        return this.set.keys();
      }

      values() {
        return this.set.values();
      }

      entries() {
        return this.set.entries();
      }

      clear() {
        this.set.length = 0;
      }

      add(elem) {
        if (!this.set.includes(elem)) {
          this.set.push(elem);
        }
      }

      delete(elem) {
        this.set = this.set.filter((el) => el !== elem);
      }

      has(elem) {
        return this.set.filter((el) => el === elem).length > 0;
      }

      forEach(cb, ctx) {
        cb = cb.bind(ctx);
        for (let i = 0; i < this.set.length; i++) {
          cb(this.set[i], i, ctx);
        }
      }

      get size() {
        return this.set.length;
      }
    }

    // Ñ‚ÐµÑÑ‚Ñ‹
    const set = new MySet([4, 8, 15, 15, 16, 23, 42]);

    // Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ
    console.log([...set], 'set'); // [ 4, 8, 15, 16, 23, 42 ]

    // ÐµÑÑ‚ÑŒ ÑÐ²Ð¾Ð¹ÑÑ‚Ð²Ð¾ size
    console.log(set.size, 'size'); // 6

    // Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð² Ñ†Ð¸ÐºÐ»Ðµ for-of
    for (const item of set) {
      console.log(item); // 4 8 15 16 23 42
    }
    //FIXME: [4,4]

    // ÐµÑÑ‚ÑŒ Ð¼ÐµÑ‚Ð¾Ð´Ñ‹ keys, values, entries
    for (const item of set.entries()) {
      console.log(item); // [ 4, 4 ] [ 8, 8 ] ...
    }
    // ÐµÑÑ‚ÑŒ Ð¼ÐµÑ‚Ð¾Ð´ clear
    set.clear();
    console.log(set.size, '// 0'); // 0

    const object4 = {
      getValue() {
        return this.value;
      },
    };

    const data = {
      value: 42,
    };

    // ÐµÑÑ‚ÑŒ Ð¼ÐµÑ‚Ð¾Ð´ add
    set.add(object4);
    console.log([...set], 'add1');
    set.add(data);
    console.log([...set], 'add2');

    // ÐµÑÑ‚ÑŒ Ð¼ÐµÑ‚Ð¾Ð´ delete
    set.delete(data);
    console.log([...set], 'delete');

    // ÐµÑÑ‚ÑŒ Ð¼ÐµÑ‚Ð¾Ð´ has
    console.log(set.has({}), '// false'); // false
    console.log(set.has(object4), '// true'); // true
    console.log(set.has(data), '// false'); // false

    // Ð¸ ÐºÐ¾Ðµ-Ñ‡Ñ‚Ð¾ ÐµÑ‰Ðµ
    console.log(set === set.valueOf(), '// true'); // true
    console.log(String(set), '// [object MySet]'); // [object MySet]
    console.log(Object.prototype.toString.call(set), '// [object MySet]'); // [object MySet]

    // Ð·Ð°Ð´Ð°Ð½Ð¸Ðµ ÑÐ¾ Ð·Ð²ÐµÐ·Ð´Ð¾Ñ‡ÐºÐ¾Ð¹ *
    // ÐµÑÑ‚ÑŒ forEach, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð´ÐµÐ»Ð°ÐµÑ‚ ÐºÐ°ÐºÐ¸Ðµ-Ñ‚Ð¾ ÑÑ‚Ñ€Ð°Ð½Ð½Ñ‹Ðµ Ð²ÐµÑ‰Ð¸...
    set.forEach(function (item) {
      console.log(item.getValue.call(this), '// 42'); // 42
    }, data);
    //#endregion
  </script>
</html>
